// Simple i18n helper for EN/MY dynamic strings
// See docs/glossary_en_ms.md for canonical terms.
(function(){
  var lang = (function(){
    try {
      var ls = localStorage.getItem('pwa_lang');
      if (ls) return ls;
      var m = document.documentElement.getAttribute('lang');
      if (m && /^ms$/i.test(m)) return 'MY';
    } catch(_) {}
    return 'EN';
  })();

  var D = {
    EN: {
      unable_load_tree: 'Unable to load family tree',
      no_members_yet: 'No family members yet.',
      no_parent_couples: 'No parent couples found',
      no_data_for_selected: 'No data for selected parents.',
      // Test tree / couple viewer additions
      couple_key: 'Couple key:',
      no_couples_found: 'No couples found',
      no_data_selected_couple: 'No data for selected couple.',
      loading: 'Loading…',
      error: 'Error',
      accept: 'Accept',
      accepting: 'Accepting…',
      accept_failed: 'Accept failed',
      saving: 'Saving…',
      failed: 'Failed',
      server_error: 'Server error',
      invites_count: '{n} invite(s)',
      revoke_failed: 'Revoke failed',
      resend_failed: 'Resend failed',
      resend: 'Resend',
      revoke: 'Revoke',
      invite_link_copied: 'Invite link copied to clipboard',
      create_failed: 'Create failed',
      validation_failed: 'Validation failed',
      self_invite_block: 'You cannot invite yourself',
      already_member: 'This user is already a member of this family.',
      pending_invite_exists: 'A pending invite already exists. Use Resend below.',
      cross_family_exists: 'This email already exists in our system. Possible duplicate person.',
      existing_account: 'Existing account',
      looks_good: 'Looks good.',
      invite_created: 'Invite created. Link copied to clipboard.',
      checking: 'Checking…',
      check_failed: 'Check failed',
      action: 'Action',
      family: 'Family',
      role: 'Role',
      scope: 'Scope',
      expires: 'Expires',
      a_family: 'A family',
  // Accept invite flow
  processing: 'Processing…',
  missing_token: 'Missing token.',
  please_sign_in_to_accept: 'Please sign in to accept this invite.',
  cannot_accept_invite: 'Cannot accept invite.',
  invite_accepted_redirecting: 'Invite accepted. Redirecting to your tree…',
  server_error_dot: 'Server error.',
  go_to_tree: 'Go to tree',
  accept_invitation: 'Accept invitation',
  // Offline page
  youre_offline: "You're offline",
  offline_hint: "Some features may be unavailable. We'll automatically retry when your connection returns.",
  try_again: 'Try again',
  // PD tree / duplicates viewer
  error_loading_pd: 'Error loading PD clusters.',
  network_error_loading: 'Network error while loading.',
  error_loading_merged: 'Error loading merged tree.',
  nodes_couples_alias: 'Nodes: {n} · Couples: {m} · Alias groups merged: {a}',
  no_alias_groups: 'No alias groups to merge in this family.',
  alias_group: 'Alias group',
  no_couples_merged: 'No couples recorded in merged view.',
  children_label: 'Children:',
  no_children_recorded: 'No children recorded',
  no_duplicate_clusters: 'No duplicate clusters detected for your family (by email and shared parents).',
      same_email: 'same email',
      shared_parents: 'shared parents',
      similar_name: 'similar name',
      similar_father: 'similar father',
      similar_mother: 'similar mother',
      finalized_merge: 'Finalize merge',
      merging: 'Merging…',
      consent_to_merge: 'Consent to merge',
      consented: "You've already consented",
      consented_already: "You've already consented",
      awaiting_acceptance: 'Awaiting invite acceptance',
      waiting_for_other_consent: 'Waiting for consent from the other party.',
      merge_failed: 'Merge failed',
      // Legal / terms headings
      legal_pack_title: 'Nasab Family Tree – Legal Pack (v1.0)',
      terms_of_use_title: 'Nasab Family Tree – Website Use Agreement (Terms of Use)',
      privacy_policy_title: 'Nasab Family Tree – Privacy Policy',
      // Abbreviations & lifecycle
      birth_abbrev: 'b.',
      death_abbrev: 'd.',
      deceased: 'deceased'
    },
    MY: {
      unable_load_tree: 'Tidak dapat memuatkan pokok keluarga',
      no_members_yet: 'Tiada ahli keluarga lagi.',
      no_parent_couples: 'Tiada pasangan ibu bapa ditemui',
      no_data_for_selected: 'Tiada data untuk ibu bapa dipilih.',
      couple_key: 'Kunci pasangan:',
      no_couples_found: 'Tiada pasangan ditemui',
      no_data_selected_couple: 'Tiada data untuk pasangan dipilih.',
      loading: 'Memuatkan…',
      error: 'Ralat',
      accept: 'Terima',
      accepting: 'Menerima…',
      accept_failed: 'Gagal menerima',
      saving: 'Menyimpan…',
      failed: 'Gagal',
      server_error: 'Ralat pelayan',
      invites_count: '{n} jemputan',
      revoke_failed: 'Gagal dibatalkan',
      resend_failed: 'Gagal hantar semula',
      resend: 'Hantar semula',
      revoke: 'Batalkan',
      invite_link_copied: 'Pautan jemputan disalin ke papan klip',
      create_failed: 'Gagal cipta',
      validation_failed: 'Pengesahan gagal',
      self_invite_block: 'Anda tidak boleh menjemput diri sendiri',
      already_member: 'Pengguna ini sudah menjadi ahli keluarga.',
      pending_invite_exists: 'Jemputan belum selesai sudah wujud. Guna Hantar semula di bawah.',
      cross_family_exists: 'Emel ini sudah wujud dalam sistem. Kemungkinan individu pendua.',
      existing_account: 'Akaun sedia ada',
      looks_good: 'Nampak baik.',
      invite_created: 'Jemputan dicipta. Pautan disalin.',
      checking: 'Memeriksa…',
      check_failed: 'Semakan gagal',
      action: 'Tindakan',
      family: 'Keluarga',
      role: 'Peranan',
      scope: 'Skop',
      expires: 'Tamat tempoh',
      a_family: 'Sebuah keluarga',
  // Accept invite flow
  processing: 'Memproses…',
  missing_token: 'Token hilang.',
  please_sign_in_to_accept: 'Sila log masuk untuk menerima jemputan ini.',
  cannot_accept_invite: 'Tidak dapat menerima jemputan.',
  invite_accepted_redirecting: 'Jemputan diterima. Mengalih ke pokok anda…',
  server_error_dot: 'Ralat pelayan.',
  go_to_tree: 'Pergi ke pokok',
  accept_invitation: 'Terima jemputan',
  // Offline page
  youre_offline: 'Anda sedang luar talian',
  offline_hint: 'Beberapa ciri mungkin tidak tersedia. Kami akan cuba semula secara automatik apabila sambungan kembali.',
  try_again: 'Cuba lagi',
  // PD tree / duplicates viewer
  error_loading_pd: 'Ralat memuat kluster PD.',
  network_error_loading: 'Ralat rangkaian semasa memuat.',
  error_loading_merged: 'Ralat memuat pokok digabung.',
  nodes_couples_alias: 'Nod: {n} · Pasangan: {m} · Kumpulan alias digabung: {a}',
  no_alias_groups: 'Tiada kumpulan alias untuk digabung bagi keluarga ini.',
  alias_group: 'Kumpulan alias',
  no_couples_merged: 'Tiada pasangan direkodkan dalam paparan gabungan.',
  children_label: 'Anak:',
  no_children_recorded: 'Tiada anak direkodkan',
  no_duplicate_clusters: 'Tiada kluster pendua ditemui untuk keluarga anda (mengikut emel dan ibu bapa yang dikongsi).',
      same_email: 'emel sama',
      shared_parents: 'ibu bapa dikongsi',
      similar_name: 'nama serupa',
      similar_father: 'bapa serupa',
      similar_mother: 'ibu serupa',
      finalized_merge: 'Dimuktamadkan gabungan',
      merging: 'Menggabungkan…',
      consent_to_merge: 'Beri kebenaran untuk gabung',
      consented: 'Anda telah memberi kebenaran',
      consented_already: 'Anda telah memberi kebenaran',
      awaiting_acceptance: 'Menunggu penerimaan jemputan',
      waiting_for_other_consent: 'Menunggu kebenaran pihak lain.',
      merge_failed: 'Gabungan gagal',
      legal_pack_title: 'Nasab Family Tree – Pakej Perundangan (v1.0)',
      terms_of_use_title: 'Nasab Family Tree – Perjanjian Penggunaan Laman (Terma Penggunaan)',
      privacy_policy_title: 'Nasab Family Tree – Dasar Privasi',
      birth_abbrev: 'l.',
      death_abbrev: 'm.',
      deceased: 'meninggal'
    }
  };

  window.T = function(key, fallback){
    var map = D[lang] || D.EN;
    return (map && map[key]) || fallback || key;
  };
})();
